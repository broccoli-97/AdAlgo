# 最小迟序排工问题（Minimum tardiness sequencing）

作为排工问题，该问题和[区间排工问题](/doc/swi.html)相似但又不同。不同之处有：
 - 没有了最早开始时间，只有最后加工期限
 - 任务的完成需要按一定顺序进行
 - 不要求全部完成，只要求未能按期完成任务的数目不超过 K 个


该问题的形式化定义如下：


**实例：** 任务集合 $T,$ 每个任务 $t \in T,$ 都有加工长度 $L(t)=1,$ 加工最后期限 $d(t) \in Z^{+}$。 在集合 $T$ 上有半序关系 $\lessdot$ 以及非负整数 $K \leqslant T\rceil_{\circ}$ 

**询问：** 是否存在 $T$ 的排工表 $\sigma: T \rightarrow\{0,1, \cdots,|T|-1\},$ 使得当 $t \neq t$ '有 $\sigma(t) \neq \sigma\left(t^{\prime}\right),$ 当 $t \lessdot t^{\prime}$
时, 有 $\sigma(t)<\sigma\left(t^{\prime}\right), \quad$ 且| $\{t \mid t \in T, \sigma(t)+1>d(t)\} \mid \leqslant K$。

该问题询问中条件 $|\{t \mid t \in T, \sigma(t)+1>d(t)\} \mid \leqslant K$ 表示在排工表 $\sigma$ 中，未能按期完成任务的 数目不超过 $K_{\circ}$

该问题可以通过将图的 [团问题](clique.html) 归约到该问题证明。


<!-- 集合上的有序关系可以通过构造有向图来定义。 -->

# NPC 证明


如果一个图内有一个 $J$ 个点的团（也即完全图），那么相应的，就会有$\frac{J(J-1)}{2}$ 条边。

现在逐步将团问题实例 $G=\{V,E\}, J$ 转换为最小迟序排工问题。  

首先，将团问题实例中的图 $G=\{V,E\}$ 中的边和点都视为加工长度为 1 的任务，此时任务总数就是 $|V|+|E|$。

随后添加半序约束：当两点 $u,v$ 之间存在边 $e$ 时，这两个点任务的优先级要比边任务 $e$ 要大。形式化表述为：

$$
u \lessdot e, v \lessdot e, \text { 当且仅当 } e=(u, v), u, v \in V, e \in E
$$
 
此时，令**最多不需要按期完成任务的数目** $K =|E|-\frac{J(J-1)}{2}$，那么**最少需要完成的任务数**也可以根据总数计算得到，为 $|E|+|V|-K = |V|+\frac{J(J-1)}{2}$ 个任务

注意到 $|V|$ 刚好是点的数量，因此剩下的 $\frac{J(J-1)}{2}$ 则需要通过边任务来填补。

此时，定义边任务 e 和点任务 v 的最后期限分别为：
$$
d(e)=\frac{J(J+1)}{2},e\in E
$$

$$
d(v)=|V|+|E|, v\in V
$$

因为 $J=\frac{J(J+1)}{2}-\frac{J(J-1)}{2}$，所以在期限 $\frac{J(J+1)}{2}$ 之前，最多只能完成 J 个点任务，其余的时间都必须分配给 $\frac{J(J-1)}{2}$ 个边任务。

此外，在 $J(J+1)/2$ 前最多只能安排 $\frac{J(J+1)}{2}$ 个边任务。因为如上所说， $J$ 个点最多只能存在 $J(J-1)/2$ 条边相互连接，所以$J(J-1)/2$个边任务的完成的前提一定是有至少 $J$ 个点任务被完成。

(<-) 此时，设在期限 $J(J+1)/2$ 之前完成的边任务为 $E'$,点任务为 $V'$，那么 $(V',E')$ 根据其数量，显然一定构成了一个完全图。

(->) 如果团问题的任意实例 $G=(V,E)$ 含有 $J$ 个顶点的团，则最小迟序排工问题相应实例的排工安排即为团对应的点任务和边任务。